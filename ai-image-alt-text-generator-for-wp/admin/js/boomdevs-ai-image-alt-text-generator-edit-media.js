!function(t){"use strict";const{__:e,sprintf:a}=wp.i18n;window.bdaiatg=window.bdaiatg||{postsPerPage:1,lastPostId:0,intervals:{},redirectUrl:""};let n,o,i,s=0,r=!1,c=0,l="",d="";function u(t,e,a){const n=new URL(window.location.href);n.searchParams.set("bdaiatg_action","generate");const o=document.createElement("div");o.id=t;const i=document.createElement("a");i.id=t+"-anchor",i.href=n,i.className="button-secondary button-large";const s=document.createElement("div");s.id=t+"-checkbox-wrapper";const r=document.createElement("input");r.type="checkbox",r.id=t+"-keywords-checkbox",r.name="bdaiatg-generate-button-keywords-checkbox";const c=document.createElement("label");c.htmlFor="bdaiatg-generate-button-keywords-checkbox",c.innerText="Add SEO keywords";const d=document.createElement("div");d.id=t+"-textfield-wrapper",d.style.display="none";const u=document.createElement("input");u.type="text",u.placeholder="keyword1, keyword2",u.id=t+"-textfield",u.name="bdaiatg-generate-button-keywords",u.size=40;const p=document.createElement("label");p.innerText="Add SEO Focus keyword",p.setAttribute("for","bdaiatg-generate-button-focus-keyword");const _=document.createElement("input");_.type="checkbox",_.id="bdaiatg-generate-button-focus-keyword",_.classList.add("bdaiatg-generate-button-focus-keyword");const g=document.createElement("p");g.id="focuskeywordError",g.style.color="#d63638",g.style.fontSize="12px",g.style.marginTop="5px",g.style.display="none",g.innerText="Focus keyword is empty, please set the focus keyword first.";const m=document.createElement("br");s.appendChild(_),s.appendChild(p),s.appendChild(m),s.appendChild(g),s.appendChild(r),s.appendChild(c),d.appendChild(u),r.addEventListener("change",(function(){this.checked?(d.style.display="block",u.setSelectionRange(0,0),u.focus()):d.style.display="none"})),_.addEventListener("change",(function(){if(this.checked){if(!window.import_csv.focus_keyword)return this.checked=!1,g.style.display="block",void setTimeout((()=>{g.style.display="none"}),3e3);l=window.import_csv.focus_keyword}})),i.onclick=function(){this.classList.add("disabled");let t=this.querySelector("span");t&&(t.innerText="Processing...")};const b=document.createElement("img");b.src=import_csv.icon_button_generate,b.alt="Update Alt Text with AI Image Alt Text Generator for WP",i.appendChild(b);const y=document.createElement("span");return y.innerText="Update Alt Text",i.appendChild(y),o.appendChild(i),o.appendChild(s),o.appendChild(d),i.addEventListener("click",(async function(t){t.preventDefault();const n="single"===a?document.getElementById("title"):document.querySelector('[data-setting="title"] input'),o="single"===a?document.getElementById("attachment_caption"):document.querySelector('[data-setting="caption"] textarea'),s="single"===a?document.getElementById("attachment_content"):document.querySelector('[data-setting="description"] textarea'),c="single"===a?document.getElementById("attachment_alt"):document.querySelector('[data-setting="alt"] textarea'),d="single"===a?document.getElementById("attachment_url"):document.querySelector('[data-setting="url"] input'),p=r.checked?v(u.value):[];import_csv.api_key||import_csv.development||(window.location.href="admin.php?page=boomdevs-ai-image-alt-text-generator-settings");const _=await async function(t,e=[],a,n,o,i,s,r,c,d,u){const p={website_url:a,file_url:n,language:i,focus_keyword:l,keywords:e,image_suffix:d,image_prefix:u,bdaiatg_alt_text_length:import_csv.alt_length,bdaiatg_alt_description:import_csv.alt_description},_=await fetch(`${import_csv.api_url}/wp-json/alt-text-generator/v1/get-alt-text`,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*",token:o},body:JSON.stringify(p)}),g=await _.json();if(!0==!g.data.status)return!1;return jQuery.ajax({type:"post",dataType:"json",url:import_csv.ajaxurl,data:{action:"bdaiatg_save_alt_text",nonce:import_csv.nonce,attachment_id:t,keywords:e,focus_keyword:l,alt_text:g.data.generated_text,generated_description_text:g.data.generated_description_text,image_title:s,image_caption:r,image_description:c,bdaiatg_alt_description:import_csv.alt_description},success:function(t){},error:function(t){console.log(t)}}),g}(e,p,import_csv.site_url,d.value,import_csv.api_key,import_csv.language,import_csv.image_title[0],import_csv.image_caption[0],import_csv.image_description[0],import_csv.image_suffix,import_csv.image_prefix);!0===_.data.status&&(c.value=_.data.generated_text,"update_title"===import_csv.image_title[0]&&(n.value=_.data.generated_text),"update_caption"===import_csv.image_caption[0]&&(o.value=_.data.generated_text),"update_description"===import_csv.image_description[0]&&(s.value=_.data.generated_text),""!==import_csv.alt_description&&"0"!==import_csv.alt_description&&(s.value=_.data.generated_description_text)),i.classList.remove("disabled"),i.querySelector("span").innerText="Update Alt Text"})),o}async function p(){const t=await fetch(`${import_csv.api_url}/wp-json/alt-text-generator/v1/available-token`,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*",token:import_csv.api_key}}),e=await t.json(),a=e.data,n=a.total_token,o=a.available_token,i=parseInt(n)-parseInt(o);return document.getElementById("bdaiatg_available_token_num").innerText=i,e}async function _(){if(0===t(".boomdevs_ai_img_alt_text_generator_dashboard").length)return!1;let e=await p();if(!e.success)return r=!0,w(e.data.message),!1;const a=document.getElementById("bdaiatg_available_token_num"),n=(document.getElementById("subscription_plan"),document.getElementById("remaining_credit")),o=document.getElementById("bdaiatg_token_token_num"),i=document.getElementById("bdaiatg_spent_token"),l=document.getElementById("bdiatgd_percent_start"),d=document.getElementById("progress"),u=e.data.available_token;s=u;let _=e.data.total_token,g=parseInt(_)-parseInt(u),m=parseInt(_)-parseInt(g);c=m,import_csv.development&&(s=200,_=200,g=200,m=200),n.innerText=m;const b=u&&_?(g/_*100).toFixed(0):0;a.innerText=u?g:0,o.innerText=_||0,i.innerText=isNaN(b)?"0":b,l.innerText=isNaN(b)?"0%":b+"%",isNaN(b)?(d.setAttribute("data-percent","0"),d.style.width="0%"):(d.setAttribute("data-percent",b),d.style.width=b+"%")}t("#bdaiatg-generate-button-seo-focus-keywords-checkbox").on("change",(function(){t(this).prop("checked")?(d=window.import_csv.focus_keyword,""===d&&t("#empty_focus_key").show()):(d="",t("#empty_focus_key").hide())})),t("#bdaiatg-generate-button-keywords-checkbox").change((function(e){this.checked?t("#bdaiatg-generate-button-keywords-seo").css({display:"block"}):t("#bdaiatg-generate-button-keywords-seo").css({display:"none"})})),t(document).on("click","#bdaiatg-generate-button-overwrite-checkbox",(function(){n=this.checked})),t("#bdaiatg_alt_text_gen_btn").click((function(){if(function(){try{if(window.wp&&wp.data&&wp.blocks)return wp.data.select("core/editor").isEditedPostDirty()}catch(t){return console.error("Error checking Gutenberg post dirty status: ",t),!0}return!0}()){if(!confirm(e("[AI Image ALT Text] Make sure to save any changes before proceeding -- any unsaved changes will be lost. Are you sure you want to continue?","ai-image-alt-text-generator-for-wp")))return}const a=document.getElementById("post_ID")?.value,o=document.getElementById("bdaiatg-generate-button-keywords-seo")?.value,i=""!==o?v(o):[];t(".bdaiatg_alt_text_gen_btn_post .loader").css({display:"block"}),t(".bdaiatg_alt_text_gen_btn_post .button_text").css({display:"none"});let s=[];if(t("#editor img").each((function(){let e=t(this).attr("src");t(this).attr("alt");e.includes("wp-content/uploads")&&s.push(e)})),!n)return t.toast({heading:"Warning",text:e("All image has alt text if you want to override please select Overwrite existing alt text."),showHideTransition:"fade",bgColor:"#DD6B20",loader:!1,icon:"warning",allowToastClose:!1,position:{right:80,top:60}}),t(".bdaiatg_alt_text_gen_btn_post .loader").css({display:"none"}),t(".bdaiatg_alt_text_gen_btn_post .button_text").css({display:"block"}),!1;jQuery.ajax({type:"post",dataType:"json",url:import_csv.ajaxurl,data:{action:"bulk_alt_image_generator_gutenburg_post",nonce:import_csv.nonce,post_id:a,focus_keyword:d,attachments:s,keywords:i,overrite_existing_images:n||!1},success:function(e){e.success&&(t.toast({heading:"Success",text:e.data.message,showHideTransition:"fade",bgColor:"#38A169",loader:!1,icon:"success",allowToastClose:!1,position:{right:80,top:60}}),window.location.reload()),!1===e.success&&(e.data.redirect&&!0===e.data.redirect?window.location.href=e.data.redirect_url:t.toast({heading:"Warning",text:e.data.message,showHideTransition:"fade",bgColor:"#DD6B20",loader:!1,icon:"warning",allowToastClose:!1,position:{right:80,top:60}})),t(".bdaiatg_alt_text_gen_btn_post .loader").css({display:"none"}),t(".bdaiatg_alt_text_gen_btn_post .button_text").css({display:"block"})},error:function(e){console.log(e),t(".bdaiatg_alt_text_gen_btn_post .loader").css({display:"none"}),t(".bdaiatg_alt_text_gen_btn_post .button_text").css({display:"block"})}})})),_(),t(document).on("click","#cancel_bulk_alt_image_generator",(function(){localStorage.removeItem("buttonDisabledStatus");let e=t(".spinner-icon");e.css({display:"block"}),jQuery.ajax({type:"post",dataType:"json",url:import_csv.ajaxurl,data:{action:"cancel_bulk_alt_image_generator",nonce:import_csv.nonce},success:function(a){t(".baiatgd_bulk_progress_card").css({display:"none"}),t(".baiatgd_bulk_smush_wrapper").css({display:"flex"}),y(),e.css({display:"none"})},error:function(t){console.log(t),e.css({display:"none"})}}),localStorage.removeItem("totalJobCount")})),t(document).on("click","#bdaiatg_bulk_generate_all",(function(){o=this.checked})),t(document).on("click","#bdaiatg_bulk_generate_only_new",(function(){i=this.checked}));const g=localStorage.getItem("buttonDisabledStatus"),m=document.getElementById("generate_alt_text");"true"===g&&(m.disabled=!0);async function b(){const e=document.getElementById("generate_alt_text");try{const a=await fetch("/wp-json/alt-text-generator/v1/fetch-jobs"),n=await a.json(),o=document.getElementById("bulk_alt_text_progress"),i=document.getElementById("total_attachment_count"),s=document.getElementById("attachment_generated_count"),r=document.getElementById("bulk-progress"),c=document.getElementById("missing_alt_text_count");if(null!==o){const a=n.data.total_jobs_count,l=n.data.count_increase,d=n.data.progress_percentage;o.innerText=Math.floor(d)+"%",r.setAttribute("data-percent",d),r.style.width=d+"%";const u=parseInt(a)-parseInt(l);if(i.innerText=a,s.innerText=l,c.innerText=u,n.data.all_status){e.disabled=!1,e.style.background="transparent",e.style.backgroundImage="linear-gradient(to right, #060097, #8204FF, #C10FFF)",localStorage.removeItem("buttonDisabledStatus"),_(),f(),y();const a=localStorage.getItem("totalJobCount");t.toast({heading:"Success",text:a+" images alt text has been generated",showHideTransition:"fade",bgColor:"#38A169",loader:!1,icon:"success",allowToastClose:!1,position:{right:80,top:60}}),localStorage.removeItem("totalJobCount")}else setTimeout(b,2e4),e.disabled=!0,t(".baiatgd_bulk_progress_card").css({display:"block"}),t(".baiatgd_bulk_smush_wrapper").css({display:"none"})}await p()}catch(t){console.log(t),y(),f()}}function y(){t("#generate_alt_text").attr("disabled",!1),t(".generate_alt_text_btn_loader").css("display","none"),t(".generate_alt_button_text").text("Generate Alt Text"),t(".bulk_loader").hide()}function h(){t("#generate_alt_text").attr("disabled",!0),t(".generate_alt_text_btn_loader").css("display","block"),t(".generate_alt_button_text").text("Generating"),t(".bulk_loader").show()}function f(){t(".baiatgd_bulk_smush_wrapper").css({display:"flex"}),t(".baiatgd_bulk_progress_card").css({display:"none"})}function w(e){t.toast({heading:"Warning",text:e,showHideTransition:"fade",bgColor:"#DD6B20",loader:!1,icon:"warning",allowToastClose:!1,position:{right:80,top:60}})}function v(t){return t.split(",").map((function(t){return t.trim()})).filter((function(t){return t.length>0})).slice(0,6)}function x(t){t=t.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");let e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}function k(t,e,a){let n=document.getElementById(t),o=document.getElementById(e);if(o&&o.remove(),n){let t=u(e,a,"modal");return n.appendChild(t),!0}return!1}"0"!==import_csv.has_jobs_list&&(t(".baiatgd_bulk_smush_wrapper").css({display:"none"}),t(".baiatgd_bulk_progress_card").css({display:"block"}),b(),y()),"1"==import_csv.has_jobs_list?h():y(),t(document).on("click","#generate_alt_text",(function(){return h(),t(".baiatgd_bulk_smush_wrapper").css({display:"none"}),t(".baiatgd_bulk_progress_card").css({display:"block"}),""!==import_csv.api_key||import_csv.development?r&&!import_csv.development?(y(),f(),w("Invalid api key please contact with support."),!1):(0!==s||import_csv.development)&&(0!==c||import_csv.development)?void jQuery.ajax({type:"post",dataType:"json",url:import_csv.ajaxurl,data:{action:"bulk_alt_image_generator",nonce:import_csv.nonce,overrite_existing_images:o||!1},success:function(e){localStorage.setItem("totalJobCount",e.data.total_jobs_count),e.success?(t.toast({heading:"Success",text:e.data.message,showHideTransition:"fade",bgColor:"#38A169",loader:!1,icon:"success",allowToastClose:!1,position:{right:80,top:60}}),0===parseInt(import_csv.has_jobs_list)&&jQuery.ajax({type:"post",dataType:"json",url:import_csv.ajaxurl,data:{action:"get_all_added_jobs",nonce:import_csv.nonce},success:function(e){t(".baiatgd_bulk_progress_card").css({display:"block"}),b()},error:function(t){console.log(t)}}),h()):(t.toast({heading:"Warning",text:e.data.message,showHideTransition:"fade",bgColor:"#DD6B20",loader:!1,icon:"warning",allowToastClose:!1,position:{right:80,top:60}}),y(),f())},error:function(t){console.log("error : ",t),y(),f(),w("Failed to start bulk generation. Please try again.")}}):(y(),f(),w("You don't have sufficient credit please purchases more and try again later"),!1):(y(),f(),w("Please set api key from settings menu."),!1)})),t(".alt-text").each((function(){t(this).data("original-value",t(this).val()),t(this).closest("tr").find(".update-alt").prop("disabled",!0)})),t(".alt-text").each((function(){t(this).data("original-value",t(this).val()),t(this).closest("tr").find(".update-alt").prop("disabled",!0)})),t(".alt-text").on("input",(function(){var e=t(this).val().trim(),a=t(this).data("original-value"),n=t(this).closest("tr").find(".update-alt");e!==a&&""!==e?n.prop("disabled",!1):n.prop("disabled",!0)})),t(".update-alt").on("click",(function(e){e.preventDefault();var a=t(this).data("media-id"),n=t(this).closest("tr").find(".alt-text").val(),o=t(this).closest("tr").find(".update-message");t.ajax({url:import_csv.ajaxurl,type:"POST",data:{action:"update_attachment_meta",nonce:import_csv.nonce,media_id:a,alt_text:n},success:function(a){if(a.success&&a.data){o.css("opacity","1"),o.text(a.data.message),setTimeout((function(){o.css("opacity","0")}),2e3);var n=t(e.target).closest("tr").find(".alt-text");n.data("original-value",n.val()),t(e.target).prop("disabled",!0)}else o.css("opacity","1"),o.text(a.data.message),o.css("color","red"),o.css("background-color","#ffe4e4"),setTimeout((function(){o.css("opacity","0")}),2e3)},error:function(){o.css("opacity","1"),o.text("Update failed."),o.css("color","red"),o.css("background-color","#ffe4e4"),setTimeout((function(){o.css("opacity","0")}),2e3)}})})),t(document).on("click","#wp_default_button",(function(t){t.preventDefault();let e=document.getElementById("file_input");if(e.files.length>0){let t=e.files[0],a=new FileReader;a.onload=function(t){let e=t.target.result.trim().split("\n"),a=[];for(let t=1;t<e.length;t++){let n={},o=e[t].split(",");for(let t=0;t<o.length;t++)n[t]=o[t].trim();a.push(n)}jQuery.ajax({type:"post",dataType:"json",url:import_csv.ajaxurl,data:{action:"import_csv",nonce:import_csv.nonce,result:a},success:function(t){}})},a.readAsText(t)}else alert("Please select a file.")})),document.addEventListener("DOMContentLoaded",(async()=>{const e=window.location.href.includes("post.php")&&jQuery("body").hasClass("post-type-attachment"),a=window.location.href.includes("post-new.php")||window.location.href.includes("post.php")&&!jQuery("body").hasClass("post-type-attachment"),n=window.location.href.includes("upload.php");let o=null,i="bdaiatg-generate-button",s="alt-text-description";if(e){if(o=x("post"),!o)return!1;if(o=parseInt(o,10),!o)return;let t=document.getElementById(s);if(t){let e=u(i,o,"single");t.appendChild(e)}}else{if(!n&&!a)return!1;if(o=x("item"),t(document).on("click","ul.attachments li.attachment",(function(){let e=t(this);e.attr("data-id")&&(o=parseInt(e.attr("data-id"),10),o&&k(s,i,o))})),document.addEventListener("click",(function(t){if(!t.target.matches(".media-modal .right, .media-modal .left"))return;const e=new URLSearchParams(window.location.search);o=e.get("item"),o&&k(s,i,o)})),!o)return!1;if(o){let t=0;window.bdaiatg.intervals.singleModal=setInterval((()=>{if(t++,t>20)return void clearInterval(interval);if(o=parseInt(o,10),!o)return;k(s,i,o)&&clearInterval(window.bdaiatg.intervals.singleModal)}),500)}}}))}(jQuery),jQuery(document).ready((function(t){var e=import_csv.current_item_id;function a(){var a,n=new URLSearchParams(window.location.search).get("item");n&&n!==e&&(a=n)&&a!==e&&t.ajax({url:import_csv.ajaxurl,type:"POST",data:{action:"get_focus_keyword",nonce:import_csv.nonce,item_id:a},success:function(t){t.success&&t.data&&(import_csv.focus_keyword=t.data.focus_keyword,e=a)}})}if(t(document).on("click",".attachment",(function(){setTimeout(a,300)})),window.MutationObserver&&-1!==window.location.href.indexOf("upload.php")){var n=location.href;new MutationObserver((function(){location.href!==n&&(n=location.href,a())})).observe(document,{subtree:!0,childList:!0})}a(),wp&&wp.media&&(wp.media.events.on("editor:image-update",(function(){a()})),wp.media.events.on("editor:frame-create",(function(){a()})))}));
