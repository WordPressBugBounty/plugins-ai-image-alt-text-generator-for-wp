!function(e){"use strict";let{__:t,sprintf:a}=wp.i18n;window.bdaiatg=window.bdaiatg||{postsPerPage:1,lastPostId:0,intervals:{},redirectUrl:""};let n=0,i=!1,o=0,s="",l="";function r(e,t,a){let n=new URL(window.location.href);n.searchParams.set("bdaiatg_action","generate");let i=document.createElement("div");i.id=e;let o=document.createElement("a");o.id=e+"-anchor",o.href=n,o.className="button-secondary button-large";let l=document.createElement("div");l.id=e+"-checkbox-wrapper";let r=document.createElement("input");r.type="checkbox",r.id=e+"-keywords-checkbox",r.name="bdaiatg-generate-button-keywords-checkbox";let c=document.createElement("label");c.htmlFor="bdaiatg-generate-button-keywords-checkbox",c.innerText="Add SEO keywords";let g=document.createElement("div");g.id=e+"-textfield-wrapper",g.style.display="none";let u=document.createElement("input");u.type="text",u.id=e+"-textfield",u.name="bdaiatg-generate-button-keywords",u.size=40;let p=document.createElement("label");p.innerText="Add SEO Focus keyword",p.setAttribute("for","bdaiatg-generate-button-focus-keyword");let b=document.createElement("p");b.innerText="No focus keywords have been set in the post where this image is used.",b.style.color="red",b.style.display="none";let h=document.createElement("input");h.type="checkbox",h.id="bdaiatg-generate-button-focus-keyword",h.classList.add("bdaiatg-generate-button-focus-keyword");let y=document.createElement("br");l.appendChild(h),l.appendChild(p),l.appendChild(y),l.appendChild(b),l.appendChild(y),l.appendChild(r),l.appendChild(c),g.appendChild(u),r.addEventListener("change",function(){this.checked?(g.style.display="block",u.setSelectionRange(0,0),u.focus()):g.style.display="none"}),h.addEventListener("change",function(){if(""==window.import_csv.focus_keyword){setTimeout(()=>{b.style.display="block"},500),this.checked=!1;return}this.checked&&(s=window.import_csv.focus_keyword)}),o.onclick=function(){this.classList.add("disabled");let e=this.querySelector("span");e&&(e.innerText="Processing...")};let m=document.createElement("img");m.src=import_csv.icon_button_generate,m.alt="Update Alt Text with AltText.ai",o.appendChild(m);let f=document.createElement("span");return f.innerText="Update Alt Text",o.appendChild(f),i.appendChild(o),i.appendChild(l),i.appendChild(g),o.addEventListener("click",async function(e){e.preventDefault();let n="single"===a?document.getElementById("title"):document.querySelector('[data-setting="title"] input'),i="single"===a?document.getElementById("attachment_caption"):document.querySelector('[data-setting="caption"] textarea'),s="single"===a?document.getElementById("attachment_content"):document.querySelector('[data-setting="description"] textarea'),l="single"===a?document.getElementById("attachment_alt"):document.querySelector('[data-setting="alt"] textarea'),c="single"===a?document.getElementById("attachment_url"):document.querySelector('[data-setting="url"] input'),g=r.checked?T(u.value):[];import_csv.api_key||import_csv.development||(window.location.href="admin.php?page=boomdevs-ai-image-alt-text-generator-settings");let p=await d(t,g,import_csv.site_url,c.value,import_csv.api_key,import_csv.language,import_csv.image_title[0],import_csv.image_caption[0],import_csv.image_description[0],import_csv.image_suffix,import_csv.image_prefix);!0===p.data.status&&(l.value=p.data.generated_text,"update_title"===import_csv.image_title[0]&&(n.value=p.data.generated_text),"update_caption"===import_csv.image_caption[0]&&(i.value=p.data.generated_text),"update_description"===import_csv.image_description[0]&&(s.value=p.data.generated_text),""!==import_csv.alt_description&&"0"!==import_csv.alt_description&&(s.value=p.data.generated_description_text)),o.classList.remove("disabled"),o.querySelector("span").innerText="Update Alt Text"}),i}async function d(e,t=[],a,n,i,o,l,r,d,c,g){let u={website_url:a,file_url:n,language:o,focus_keyword:s,keywords:t,image_suffix:c,image_prefix:g,bdaiatg_alt_text_length:import_csv.alt_length,bdaiatg_alt_description:import_csv.alt_description},p=await fetch(`${import_csv.api_url}/wp-json/alt-text-generator/v1/get-alt-text`,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*",token:i},body:JSON.stringify(u)}),b=await p.json();return!0!=!b.data.status&&(jQuery.ajax({type:"post",dataType:"json",url:import_csv.ajaxurl,data:{action:"bdaiatg_save_alt_text",nonce:import_csv.nonce,attachment_id:e,keywords:t,focus_keyword:s,alt_text:b.data.generated_text,generated_description_text:b.data.generated_description_text,image_title:l,image_caption:r,image_description:d,bdaiatg_alt_description:import_csv.alt_description},success:function(e){},error:function(e){console.log(e)}}),b)}async function c(){let e=await fetch(`${import_csv.api_url}/wp-json/alt-text-generator/v1/available-token`,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*",token:import_csv.api_key}});return await e.json()}e("#bdaiatg-generate-button-seo-focus-keywords-checkbox").on("change",function(){e(this).prop("checked")?""===(l=window.import_csv.focus_keyword)&&e("#empty_focus_key").show():(l="",e("#empty_focus_key").hide())}),e("#bdaiatg-generate-button-keywords-checkbox").change(function(t){this.checked?e("#bdaiatg-generate-button-keywords-seo").css({display:"block"}):e("#bdaiatg-generate-button-keywords-seo").css({display:"none"})});let g=!1;function u(){jQuery.ajax({type:"post",dataType:"json",url:import_csv.ajaxurl,data:{action:"get_all_added_jobs",nonce:import_csv.nonce},success:function(t){e(".baiatgd_bulk_progress_card").css({display:"block"}),f(),x()}})}async function p(){if(0===e(".boomdevs_ai_img_alt_text_generator_dashboard").length)return!1;let t=await c();if(!t.success)return i=!0,v(t.data.message),!1;let a=document.getElementById("bdaiatg_available_token_num");document.getElementById("subscription_plan");let s=document.getElementById("remaining_credit"),l=document.getElementById("bdaiatg_token_token_num"),r=document.getElementById("bdaiatg_spent_token"),d=document.getElementById("bdiatgd_percent_start"),g=document.getElementById("progress"),u=t.data.available_token;n=u;let p=t.data.total_token,b=parseInt(p)-parseInt(u),h=parseInt(p)-parseInt(b);o=h,import_csv.development&&(n=200,p=200,b=200,h=200),s.innerText=h;let y=u&&p?(b/p*100).toFixed(0):0;a.innerText=u?b:0,l.innerText=p||0,r.innerText=isNaN(y)?"0":y,d.innerText=isNaN(y)?"0%":y+"%",isNaN(y)?(g.setAttribute("data-percent","0"),g.style.width="0%"):(g.setAttribute("data-percent",y),g.style.width=y+"%")}e(document).on("click","#bdaiatg-generate-button-overwrite-checkbox",function(){g=this.checked&&!0}),e("#bdaiatg_alt_text_gen_btn").click(function(){if(function e(){try{if(window.wp&&wp.data&&wp.blocks)return wp.data.select("core/editor").isEditedPostDirty()}catch(t){console.error("Error checking Gutenberg post dirty status: ",t)}return!0}()){let a=confirm(t("[AI Image ALT Text] Make sure to save any changes before proceeding -- any unsaved changes will be lost. Are you sure you want to continue?","ai-image-alt-text-generator-for-wp"));if(!a)return}let n=document.getElementById("post_ID")?.value,i=document.getElementById("bdaiatg-generate-button-keywords-seo")?.value,o=""!==i?T(i):[];e(".bdaiatg_alt_text_gen_btn_post .loader").css({display:"block"}),e(".bdaiatg_alt_text_gen_btn_post .button_text").css({display:"none"});let s=[];if(e("#editor img").each(function(){let t=e(this).attr("src");e(this).attr("alt"),t.includes("wp-content/uploads")&&s.push(t)}),!1===g)return e.toast({heading:"Warning",text:t("All image has alt text if you want to override please select Overwrite existing alt text."),showHideTransition:"fade",bgColor:"#DD6B20",loader:!1,icon:"warning",allowToastClose:!1,position:{right:80,top:60}}),e(".bdaiatg_alt_text_gen_btn_post .loader").css({display:"none"}),e(".bdaiatg_alt_text_gen_btn_post .button_text").css({display:"block"}),!1;jQuery.ajax({type:"post",dataType:"json",url:import_csv.ajaxurl,data:{action:"bulk_alt_image_generator_gutenburg_post",nonce:import_csv.nonce,post_id:n,focus_keyword:l,attachments:s,keywords:o,overrite_existing_images:!!g&&g},success:function(t){t.success&&(e.toast({heading:"Success",text:t.data.message,showHideTransition:"fade",bgColor:"#38A169",loader:!1,icon:"success",allowToastClose:!1,position:{right:80,top:60}}),window.location.reload()),!1===t.success&&(t.data.redirect&&!0===t.data.redirect?window.location.href=t.data.redirect_url:e.toast({heading:"Warning",text:t.data.message,showHideTransition:"fade",bgColor:"#DD6B20",loader:!1,icon:"warning",allowToastClose:!1,position:{right:80,top:60}})),e(".bdaiatg_alt_text_gen_btn_post .loader").css({display:"none"}),e(".bdaiatg_alt_text_gen_btn_post .button_text").css({display:"block"})},error:function(t){console.log(t),e(".bdaiatg_alt_text_gen_btn_post .loader").css({display:"none"}),e(".bdaiatg_alt_text_gen_btn_post .button_text").css({display:"block"})}})}),p(),e(document).on("click","#cancel_bulk_alt_image_generator",function(){localStorage.removeItem("buttonDisabledStatus");let t=e(".spinner-icon");t.css({display:"block"}),jQuery.ajax({type:"post",dataType:"json",url:import_csv.ajaxurl,data:{action:"cancel_bulk_alt_image_generator",nonce:import_csv.nonce},success:function(a){e(".baiatgd_bulk_progress_card").css({display:"none"}),t.css({display:"none"})},error:function(e){console.log(e),t.css({display:"none"})}})});let b,h;e(document).on("click","#bdaiatg_bulk_generate_all",function(){b=this.checked}),e(document).on("click","#bdaiatg_bulk_generate_only_new",function(){h=this.checked});let y=localStorage.getItem("buttonDisabledStatus"),m=document.getElementById("generate_alt_text");async function f(){document.getElementById("generate_alt_text");try{let t=await fetch("/wp-json/alt-text-generator/v1/fetch-jobs"),a=await t.json(),n=document.getElementById("bulk_alt_text_progress"),i=document.getElementById("total_attachment_count"),o=document.getElementById("attachment_generated_count"),s=document.getElementById("bulk-progress");if(null!==n){n.innerText=Math.floor(a.data.progress_percentage)+"%",s.setAttribute("data-percent",a.data.progress_percentage),s.style.width=a.data.progress_percentage+"%",i.innerText=a.data.total_jobs_count,o.innerText=a.data.count_increase;var l=document.getElementsByClassName("baiatgd_bulk_smush_quantity")[0].innerText;a.data.all_status?(m.disabled=!1,m.style.background="transparent",m.style.backgroundImage="linear-gradient(to right, #060097, #8204FF, #C10FFF)",localStorage.removeItem("buttonDisabledStatus"),p(),e(".baiatgd_bulk_progress_card").css({display:"none"}),e.toast({heading:"Success",text:l+" images alt text has been generated",showHideTransition:"fade",bgColor:"#38A169",loader:!1,icon:"success",allowToastClose:!1,position:{right:80,top:60}})):(setTimeout(f,2e4),m.disabled=!0,e(".baiatgd_bulk_progress_card").css({display:"block"}))}await c()}catch(r){console.log(r)}}function x(){e("#generate_alt_text").attr("disabled",!1),e(".generate_alt_text_btn_loader").css("display","none")}function k(){e("#generate_alt_text").attr("disabled",!0),e(".generate_alt_text_btn_loader").css("display","block")}"true"===y&&(m.disabled=!0),"0"!==import_csv.has_jobs_list&&(e(".baiatgd_bulk_progress_card").css({display:"block"}),f(),x());let $=e("#baiatgd_comming_soon"),w=e("#baiatgd_close_modal");function v(t){e.toast({heading:"Warning",text:t,showHideTransition:"fade",bgColor:"#DD6B20",loader:!1,icon:"warning",allowToastClose:!1,position:{right:80,top:60}})}function T(e){return e.split(",").map(function(e){return e.trim()}).filter(function(e){return e.length>0}).slice(0,6)}function E(e){let t=RegExp("[\\?&]"+(e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]"))+"=([^&#]*)").exec(window.location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function _(e,t,a){let n=document.getElementById(e),i=document.getElementById(t);if(i&&i.remove(),n){let o=r(t,a,"modal");return n.appendChild(o),!0}return!1}w.on("click",function(){$.css("display","none")}),e(window).on("click",function(t){e(t.target).is($)&&$.css("display","none")}),!0==import_csv.bulk_generating?(k(),e(".generate_alt_button_text").text("Generating"),e(".bulk_loader").show()):(x(),e(".generate_alt_button_text").text("Generate Alt Text"),e(".bulk_loader").hide()),e(document).on("click","#generate_alt_text",function(){return(k(),e(".generate_alt_button_text").text("Generating"),e(".bulk_loader").show(),""!==import_csv.api_key||import_csv.development)?i&&!import_csv.development?(x(),e(".generate_alt_button_text").text("Generate Alt Text"),e(".bulk_loader").hide(),v("Invalid api key please contact with support."),!1):(0!==n||import_csv.development)&&(0!==o||import_csv.development)?void jQuery.ajax({type:"post",dataType:"json",url:import_csv.ajaxurl,data:{action:"send_bulk_images",nonce:import_csv.nonce,overrite_existing_images:!!b&&b},success:function(t){console.log("response : ",t),t.success?(e.toast({heading:"Success",text:t.data.message,showHideTransition:"fade",bgColor:"#38A169",loader:!1,icon:"success",allowToastClose:!1,position:{right:80,top:60}}),k(),$.css("display","flex")):(e.toast({heading:"Warning",text:t.data.message,showHideTransition:"fade",bgColor:"#DD6B20",loader:!1,icon:"warning",allowToastClose:!1,position:{right:80,top:60}}),x(),e(".generate_alt_button_text").text("Generate Alt Text"),e(".bulk_loader").hide())},error:function(t){console.log("error : ",t),e(".generate_alt_button_text").text("Generate Alt Text"),e(".bulk_loader").hide(),x()}}):(e(".generate_alt_button_text").text("Generate Alt Text"),e(".bulk_loader").hide(),v("You don't have sufficient credit please purchases more and try again letter"),x(),!1):(x(),e(".generate_alt_button_text").text("Generate Alt Text"),e(".bulk_loader").hide(),v("Please set api key from settings menu."),!1)}),e(document).on("click","#wp_default_button",function(e){e.preventDefault();let t=document.getElementById("file_input");if(t.files.length>0){let a=t.files[0],n=new FileReader;n.onload=function(e){let t=e.target.result.trim().split("\n"),a=[];for(let n=1;n<t.length;n++){let i={},o=t[n].split(",");for(let s=0;s<o.length;s++)i[s]=o[s].trim();a.push(i)}jQuery.ajax({type:"post",dataType:"json",url:import_csv.ajaxurl,data:{action:"import_csv",nonce:import_csv.nonce,result:a},success:function(e){}})},n.readAsText(a)}else alert("Please select a file.")}),document.addEventListener("DOMContentLoaded",async()=>{let t=window.location.href.includes("post.php")&&jQuery("body").hasClass("post-type-attachment"),a=window.location.href.includes("post-new.php")||window.location.href.includes("post.php")&&!jQuery("body").hasClass("post-type-attachment"),n=window.location.href.includes("upload.php"),i=null,o="bdaiatg-generate-button",s="alt-text-description";if(t){if(!(i=E("post")))return!1;if(!(i=parseInt(i,10)))return;let l=document.getElementById(s);if(l){let d=r(o,i,"single");l.appendChild(d)}}else{if(!n&&!a||(i=E("item"),e(document).on("click","ul.attachments li.attachment",function(){let t=e(this);t.attr("data-id")&&(i=parseInt(t.attr("data-id"),10))&&_(s,o,i)}),document.addEventListener("click",function(e){if(!e.target.matches(".media-modal .right, .media-modal .left"))return;let t=new URLSearchParams(window.location.search);(i=t.get("item"))&&_(s,o,i)}),!i))return!1;if(i){let c=0;window.bdaiatg.intervals.singleModal=setInterval(()=>{if(++c>20){clearInterval(interval);return}if(i=parseInt(i,10))_(s,o,i)&&clearInterval(window.bdaiatg.intervals.singleModal)},500)}}})}(jQuery),jQuery(document).ready(function(e){var t=import_csv.current_item_id;function a(){var a,n=new URLSearchParams(window.location.search).get("item");n&&n!==t&&(a=n)&&a!==t&&e.ajax({url:import_csv.ajaxurl,type:"POST",data:{action:"get_focus_keyword",nonce:import_csv.nonce,item_id:a},success:function(e){e.success&&e.data&&(import_csv.focus_keyword=e.data.focus_keyword,t=a)}})}if(e(document).on("click",".attachment",function(){setTimeout(a,300)}),window.MutationObserver&&-1!==window.location.href.indexOf("upload.php")){var n=location.href;new MutationObserver(function(){location.href!==n&&(n=location.href,a())}).observe(document,{subtree:!0,childList:!0})}a(),wp&&wp.media&&(wp.media.events.on("editor:image-update",function(){a()}),wp.media.events.on("editor:frame-create",function(){a()}))});